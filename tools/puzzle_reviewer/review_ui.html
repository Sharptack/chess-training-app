<!-- tools/puzzle_reviewer/review_ui.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Puzzle Reviewer</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .puzzle-card { 
            border: 2px solid #ddd; 
            padding: 15px; 
            margin: 10px 0;
            border-radius: 8px;
        }
        .puzzle-card.selected { border-color: #4CAF50; background: #f0f8f0; }
        .puzzle-info { margin: 10px 0; }
        .buttons { margin: 10px 0; }
        button { padding: 8px 15px; margin: 5px; }
        .selected-count { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: #4CAF50; 
            color: white; 
            padding: 10px 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Puzzle Reviewer - <span id="levelName"></span></h1>
    
    <div class="selected-count">
        Selected: <span id="selectedCount">0</span> / 15
    </div>
    
    <input type="file" id="fileInput" accept=".json">
    <button onclick="exportSelected()">Export Selected Puzzles</button>
    
    <div id="puzzles"></div>
    
    <script>
        let puzzles = [];
        let selectedPuzzles = new Set();
        
        document.getElementById('fileInput').addEventListener('change', loadPuzzles);
        
        function loadPuzzles(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                puzzles = JSON.parse(e.target.result);
                displayPuzzles();
            };
            
            reader.readAsText(file);
        }
        
        function displayPuzzles() {
            const container = document.getElementById('puzzles');
            container.innerHTML = '';
            
            puzzles.forEach((puzzle, index) => {
                const card = document.createElement('div');
                card.className = 'puzzle-card';
                card.id = `puzzle-${index}`;
                
                card.innerHTML = `
                    <div class="puzzle-info">
                        <strong>Puzzle ${index + 1}</strong> | 
                        Rating: ${puzzle.rating} | 
                        Popularity: ${puzzle.popularity}
                    </div>
                    <div class="puzzle-info">
                        <strong>Themes:</strong> ${puzzle.themes.join(', ')}
                    </div>
                    <div class="puzzle-info">
                        <strong>FEN:</strong> <code>${puzzle.fen}</code>
                    </div>
                    <div class="puzzle-info">
                        <strong>Solution:</strong> ${puzzle.moveSequence.join(' â†’ ')}
                    </div>
                    <div class="buttons">
                        <button onclick="viewOnLichess('${puzzle.lichess_url}')">View on Lichess</button>
                        <button onclick="toggleSelect(${index})">Select</button>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        function toggleSelect(index) {
            const puzzleId = puzzles[index].id;
            
            if (selectedPuzzles.has(puzzleId)) {
                selectedPuzzles.delete(puzzleId);
                document.getElementById(`puzzle-${index}`).classList.remove('selected');
            } else {
                selectedPuzzles.add(puzzleId);
                document.getElementById(`puzzle-${index}`).classList.add('selected');
            }
            
            document.getElementById('selectedCount').textContent = selectedPuzzles.size;
        }
        
        function viewOnLichess(url) {
            window.open(url, '_blank');
        }
        
        function exportSelected() {
            const selected = puzzles.filter(p => selectedPuzzles.has(p.id));
            
            if (selected.length === 0) {
                alert('No puzzles selected!');
                return;
            }
            
            // Convert to your final format (remove extra metadata)
            const finalPuzzles = selected.map(p => ({
                id: p.id,
                fen: p.fen,
                moveSequence: p.moveSequence,
                hint: p.hint
            }));
            
            const json = JSON.stringify(finalPuzzles, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'selected_puzzles.json';
            a.click();
        }
    </script>
</body>
</html>